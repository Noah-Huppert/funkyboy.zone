// WARNING
//
// Do NOT edit this file while ZNC is running!
// Use webadmin or *controlpanel instead.
//
// Altering this file by hand will forfeit all support.
//
// But if you feel risky, you might want to read help on /znc saveconfig and /znc rehash.
// Also check https://wiki.znc.in/Configuration
{% set crt_file_w_out_ext = pillar['caddy']['caddy_path'] + '/acme/acme-v02.api.letsencrypt.org/sites/' + pillar['znc']['caddy']['host'] + '/' + pillar['znc']['caddy']['host'] %}
AnonIPLimit = 10
AuthOnlyViaModule = false
ConfigWriteDelay = 0
ConnectDelay = 5
HideVersion = false
LoadModule = webadmin
MaxBufferSize = 500
ProtectWebSessions = true
SSLCertFile = {{ crt_file_w_out_ext }}.crt
SSLDHParamFile = {{ crt_file_w_out_ext }}.crt
SSLKeyFile = {{ crt_file_w_out_ext }}.key
ServerThrottle = 30
Version = 1.7.2

<Listener listener0>
	AllowIRC = true
	AllowWeb = false
	IPv4 = true
	IPv6 = true
	Port = {{ pillar.znc.ports.irc }}
	SSL = true
	URIPrefix = /
</Listener>

<Listener listener1>
	AllowIRC = false
	AllowWeb = true
	IPv4 = true
	IPv6 = true
	Port = {{ pillar.znc.ports.internal_web }}
	SSL = false
	URIPrefix = /
</Listener>
{% for user_name, user in pillar['znc']['users'].items() %}
<User {{ user_name }}>
	Admin = true
	AltNick = {{ user.nick }}_alt
	AppendTimestamp = false
	AuthOnlyViaModule = false
	AutoClearChanBuffer = true
	AutoClearQueryBuffer = true
	BindHost = 127.0.0.1
	ChanBufferSize = 50
	DenyLoadMod = false
	DenySetBindHost = false
	Ident = {{ user.nick }}
	JoinTries = 10
	LoadModule = chansaver
	LoadModule = controlpanel
	MaxJoins = 0
	MaxNetworks = 1
	MaxQueryBuffers = 50
	MultiClients = true
	Nick = {{ user.nick }}
	NoTrafficTimeout = 180
	PrependTimestamp = true
	QueryBufferSize = 50
	QuitMsg = {{ user.quit_msg }}
	RealName = {{ user.real_name }}
	StatusPrefix = *
	TimestampFormat = [%H:%M:%S]

	<Network freenode>
		BindHost = 0.0.0.0
		FloodBurst = 9
		FloodRate = 2.00
		IRCConnectEnabled = true
		JoinDelay = 0
		LoadModule = simple_away
		LoadModule = sasl
		Server = chat.freenode.net +6697 
		TrustAllCerts = false
		TrustPKI = true{% for channel in user.channels %}

		<Chan {{ channel }}>
		</Chan>{% endfor %}
	</Network>

	<Pass password>
		Hash = {{ user.password.hash }}
		Method = SHA256
		Salt = {{ user.password.salt }}
	</Pass>
</User>
{% endfor %}
